<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ccs.cmn.mapper.servicecenter.QuestionMapper">

<!-- ** 1:1 문의 ** -->

	<!-- 1:1 문의 목록 조회 -->
	<select id="selectQuestionList" parameterType="java.util.Map" resultType="java.util.Map">
			SELECT Q.QUESTIONNO
					, Q.TITLE
					, Q.CONTENT
					, Q.ANSWER_YN
					, Q.FILE_GRP_ID
					, A.COMMENT
					, A.UPDT_DT AS ANSWER_DT
					, U.USER_CD 
					, U.NICKNAME
			FROM TB_QUESTION Q
				JOIN TB_USER U
					ON Q.USER_CD = U.USER_CD
				LEFT JOIN TB_ANSWER A
					ON Q.ANSWER_YN = 'Y'
						AND A.QUESTIONNO = Q.QUESTIONNO
			WHERE Q.USER_CD = #{_SESSION_USER_CD_}
			ORDER BY Q.QUESTIONNO DESC
	</select>
	
	<!-- 1:1 문의 수정 -->
	<insert id="insertQuestion" parameterType="java.util.Map" useGeneratedKeys="true" keyColumn="questionno" keyProperty="questionno">
		INSERT INTO TB_QUESTION
			(
				TITLE
				, CONTENT
				, ANSWER_YN
				<if test="file_grp_id != null and !file_grp_id.equals('')">
				, FILE_GRP_ID
				</if>
				, USER_CD
				, REG_ID
				, REG_DT
				, UPDT_ID
				, UPDT_DT
			)
			VALUES
			(
				#{title}
				, #{content}
				, 'N'
				<if test="file_grp_id != null and !file_grp_id.equals('')">
				, #{file_grp_id}
				</if>
				, #{_SESSION_USER_CD_} -- 입력사용자
				, #{_SESSION_USER_CD_} -- 입력사용자
				, NOW() -- 입력일자
				, #{_SESSION_USER_CD_} -- 변경사용자
				, NOW() -- 변경일자
			)
	</insert>
</mapper>